# Ethernet (以太网)

> 以太网帧，在以太网链路上的数据包称作以太帧

## 资源

> [以太网帧格式](https://www.jianshu.com/p/6f46d9a78d74)

## 简介

来自线路的二进制数据包称作一个帧。从物理线路上看到的帧，除其他信息外，还可看到前导码和帧开始符。任何物理硬件都会需要这些信息。

以太帧有很多种类型。不同类型的帧具有不同的格式和MTU值。但在同种物理媒体上都可同时存在。

以太网链路传输的数据包称做以太帧，或者以太网数据帧。在以太网中，网络访问层的软件必须把数据转换成能够通过网络适配器硬件进行传输的格式。


目前主要有两种格式的以太网帧：Ethernet II（DIX 2.0）和IEEE 802.3。IP、ARP、EAP和QICQ协议使用Ethernet II帧结构，而STP协议则使用IEEE 802.3帧结构。

Ethernet II是由Xerox与DEC、Intel（DIX）在1982年制定的以太网标准帧格式，后来被定义在RFC894中。


## 以太网帧

> 以太帧的工作机制，当以太网软件从网络层接收到数据报之后，需要完成如下操作：

1) 根据需要把网际层的数据分解为较小的块，以符合以太网帧数据段的要求。

  以太网帧的整体大小必须在 64～1518 字节之间（不包含前导码）。有些系统支持更大的帧，最大可以支持 9000 字节。有些系统支持更大的帧，最大可以支持 9000 字节。

2) 把数据块打包成帧。

  每一帧都包含数据及其他信息，这些信息是以太网网络适配器处理帧所需要的。

3) 把数据帧传递给对应于 OSI 模型物理层的底层组件，后者把帧转换为比特流，并且通过传输介质发送出去。

4) 以太网上的其他网络适配器接收到这个帧，检查其中的目的地址。如果目的地址与网络适配器的地址相匹配，适配器软件就会处理接收到的帧，把数据传递给协议栈中较高的层。


> 以太网帧结构

以太帧起始部分由前导码和帧开始符组成。后面紧跟着一个以太网报头，以MAC地址说明目的地址和源地址。帧的中部是该帧负载的包含其他协议报头的数据包(例如IP协议)。以太帧由一个32位冗余校验码结尾。它用于检验数据传输是否出现损坏。

以太帧起始部分由前同步码和帧开始定界符组成，后面紧跟着一个以太网报头，以 MAC 地址说明目的地址和源地址。以太帧的中部是该帧负载的包含其他协议报头的数据包，如 IP 协议。
以太帧由一个 32 位冗余校验码结尾，用于检验数据传输是否出现损坏。

![](http://c.biancheng.net/uploads/allimg/191106/6-191106130541362.gif)

![](https://img-blog.csdnimg.cn/20190903112448709.png


物理层 ：前同步码 (7B) + 帧开始界定符 (1B) + 以太网帧 

1. 前同步码 (7B)

  用来使接收端的适配器在接收 MAC 帧时能够迅速调整时钟频率，使它和发送端的频率相同。前同步码为 7 个字节，1 和 0 交替。

2. 帧开始定界符 (1B)

  帧的起始符，为 1 个字节。前 6 位 1 和 0 交替，最后的两个连续的 1 表示告诉接收端适配器：“帧信息要来了，准备接收”。


以太网帧 = 目的MAC地址 (6B) + 源MAC地址(6B) + 类型(2B) + 数据(DATA字节，一般为 IP数据包 46-1500) + 帧检测(FCS, 4B)

1. 目的地址 (6B)

  接收帧的网络适配器的物理地址（MAC 地址），为 6 个字节（48 比特）。作用是当网卡接收到一个数据帧时，首先会检查该帧的目的地址，是否与当前适配器的物理地址相同，如果相同，就会进一步处理；如果不同，则直接丢弃。

2. 源地址 (6B)

  发送帧的网络适配器的物理地址（MAC 地址），为 6 个字节（48 比特）。

3. 类型 (2B)

  上层协议的类型。由于上层协议众多，所以在处理数据的时候必须设置该字段，标识数据交付哪个协议处理。例如，字段为 0x0800 时，表示将数据交付给 IP 协议。

4. 数据

  也称为效载荷，表示交付给上层的数据。以太网帧数据长度最小为 46 字节，最大为 1500 字节。如果不足 46 字节时，会填充到最小长度。最大值也叫最大传输单元（MTU）。通常为 1500。

5. 帧校验序列 FCS (4B)

  检测该帧是否出现差错，占 4 个字节（32 比特）。发送方计算帧的循环冗余码校验（CRC）值，把这个值写到帧里。接收方计算机重新计算 CRC，与 FCS 字段的值进行比较。如果两个值不相同，则表示传输过程中发生了数据丢失或改变。这时，就需要重新传输这一帧。


> 以太网帧 (没有前同步码，帧开始界定符、帧校验序列)

在物理层上网卡要先去掉前导同步码和帧开始定界符，然后对帧进行CRC检验，如果帧校验和错，就丢弃此帧。如果校验和正确，就判断帧的目 的硬件地址是否符合自己的接收条件（目的地址是自己的物理硬件地址、广播地址、可接收的多播硬件地址等），如果符合，就将帧交“设备驱动程序”做进一步处 理。这时我们的抓包软件才能抓到数据，因此，抓包软件抓到的是去掉前导同步码、帧开始分界符、FCS之外的数据。

```
00 E0 4C 36 03 41 02 42 0A 0B 01 B1 08 00 45 00
00 34 92 9B 40 00 40 06 90 90 0A 0B 01 B0 0A 0B
01 D3 23 2A 0F 36 59 8A CF 34 74 9E 4B 31 50 18
00 ED 73 96 00 00 00 00 00 0C 00 00 00 04 00 00
08 A6
---------- ---------- ---------- ----------
00 E0 4C 36 03 41
02 42 0A 0B 01 B1
08 00
45 00 00 34 92 9B 40 00 40 06 90 90 0A 0B 01 B0 0A 0B
01 D3 23 2A 0F 36 59 8A CF 34 74 9E 4B 31 50 18 00 ED
73 96 00 00 00 00 00 0C 00 00 00 04 00 00 08 A6
```

00 E0 4C 36 03 41 -> 源MAC地址
02 42 0A 0B 01 B1 -> 目的MAC地址
08 00             -> 类型，0x0800 IP 协议

