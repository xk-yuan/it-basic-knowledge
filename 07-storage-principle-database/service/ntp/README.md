
# Network Time Protocol（NTP）

> 网络时间协议

用来使计算机时间同步化的一种协议，它可以使计算机对其服务器或时钟源（如石英钟，GPS等等)做同步化，它可以提供高精准度的时间校正（LAN上与标准间差小于1毫秒，WAN上几十毫秒），且可介由加密确认的方式来防止恶毒的协议攻击。时间按NTP服务器的等级传播。按照离外部UTC源的远近把所有服务器归入不同的Stratum（层）中。

为防止对时间服务器的恶意破坏，NTP使用了识别(Authentication)机制，检查来对时的信息是否是真正来自所宣称的服务器并检查资料的返回路径，以提供对抗干扰的保护机制。

## 资源

> [官网](http://www.ntp.org/)
>
>  - [](http://support.ntp.org/bin/view/Servers/StratumOneTimeServers)


## 简介

时间服务器可以利用以下三种方式与其他服务器对时：

1. broadcast/multicast

主要适用于局域网的环境，时间服务器周期性的以广播的方式，将时间信息传送给其他网路中的时间服务器，其时间仅会有少许的延迟，而且配置非常的简单。但是此方式的精确度并不高，对时间精确度要求不是很高的情况下可以采用。

2. symmetric

需要一台服务器可以从远端时间服务器获取时钟，如果需要也可提供时间信息给远端的时间服务器。此一方式适用于配置冗余的时间服务器，可以提供更高的精确度给主机。

3. client/server

与symmetric方式比较相似，只是不提供给其他时间服务器时间信息，此方式适用于一台时间服务器接收上层时间服务器的时间信息，并提供时间信息给下层的用户。


时间信息的传输都使用UDP协议。

时间服务器利用一个过滤演算法，及先前八个校时资料计算出时间参考值，判断后续校时包的精确性，一个相对较高的离散程度，表示一个对时资料的可信度比较低。仅从一个时间服务器获得校时信息，不能校正通讯过程所造成的时间偏差，而同时与许多时间服务器通信校时，就可利用过滤算法找出相对较可靠的时间来源，然后采用它的时间来校时

网络时间协议（NTP）的首次实现记载在Internet Engineering Note之中，其精确度为数百毫秒。稍后出现了首个时间协议的规范，即RFC-778，它被命名为DCNET互联网时间服务，而它提供这种服务还是借助于Internet control MessageProtocol(ICMP)，即互联网控制消息协议中的时间戳和时间戳应答消息。

名称的首次出现是在RFC-958之中，该版本也被称为NTP v0，其目的是为ARPA网提供时间同步。它己完全脱离ICMP，是作为独立的协议以完成更高要求的时间同步。它对于如本地时钟的误差估算和精密度等基本运算、参考时钟的特性、网络上的分组数据包及其消息格式进行了描述。但是不对任何频率误差进行补偿，也没有规定滤波和同步的算法。

美国特拉华大学(University of Delaware)的David L .Mills主持了由美国国防部高级研究计划局DARPA、美国国家科学基金NSF和美国海军水面武器中心NSWC资助的网络时间同步项目，成功的开发出了NTP协议的第1, 2, 3版。

NTP version 1 出现于1988年6月，在RFC-1059中描述了首个完整的NTP的规范和相关算法。这个版本已经采用了client/server模式以及对称操作，但是它不支持授权鉴别和NTP的控制消息。

1989年9月推出了取代RFC-958和RFC-1059的NTP v2版本即RFC-1119。

几乎同时，DEC公司也推出了一个时间同步协议，数字时间同步服务DTSS(Digital Time Synchronization Service).在 19 92 年3月，NTP v3版本RFC-1305问世，该版本总结和综合了NTP先前版本和DTSS，正式引入了校正原则，并改进了时钟选择和时钟滤波的算法，而且还引入了时间消息发送的广播模式，这个版本取代了NTP的先前版本。

NTP v 3 发布后，一直在不断地进行改进，NTP实现的一个重要功能是对计算机操作系统的时钟调整。在NTPv3研究和推出的同时，有关在操作系统核心中改进时间保持功能的研究也在并行地进行。1994年推出了RFC-1559，名为A KernelModel for Precision Time keening，即精密时01保持的核心模式，这个实现可以把计算机操作系统的时间精确度保持在微秒数量级。几乎同时，改进建议。对本地时钟调整算法，通信模式，新的时钟驱动器，又提出了NTP v4适配规则等方面的改进描述了具体方向。

NTP的第4版正在研究和测试中，网络时间同步技术也将向更高精度、更强的兼容性和多平台的适应性方向发展。网络时间协议NTP是用于互联网中时间同步的标准之一，它的用途是把计算机的时钟同步到世界协调时UTC，其精度在局域网内可达0.1ms，在Internet上绝大多数的地方其精度可以达到1- 50ms 。

NTP version4 是一个很重要的NTP协议，可是还没有一个正式的RFC文本协议的描述。值得提一下的是，简单的NTP（SNTP）version4已经在RFC2030描述了
